#!/usr/bin/env python2

import argparse
import json
import os

DEFAULT_OUT_FILENAME = 'analyzed_results.json'

class DetectionAnalyzer:
   def __init__(self, detection_results):
      self._detection_results = detection_results
      self._analyzed_results = {}

   def run(self):
      # TODO(jayden):
      # For every package, extract the features and record
      # the result for each feature in a dictionary mapping
      # features to a tuple of (detection_result, count)
      self._analyzed_results = self._detection_results
      return self._analyzed_results

if __name__ == '__main__':
   parser = argparse.ArgumentParser()
   parser.add_argument('detection_results',
                       help=('JSON file with detection results, generated by '
                             'detection_harness'))
   parser.add_argument('--out', help="output file path, default: %s" % DEFAULT_OUT_FILENAME,
                       default=DEFAULT_OUT_FILENAME)
   args = parser.parse_args()

   # Verify detection results.
   detection_results_path = os.path.join(os.getcwd(), args.detection_results)
   if not os.path.isfile(detection_results_path):
      sys.stderr.write('detection results file "%s" does not exist' % args.detection_results)
      exit(errno.ENOENT)

   # Read detection results.
   with open(detection_results_path) as f:
      detection_results = json.load(f)

   analyzer = DetectionAnalyzer(detection_results)
   analyzed_results = analyzer.run()

   # Save results to output file.
   with open(os.path.join(os.getcwd(), args.out), 'w') as f:
      json.dump(analyzed_results, f, indent=4)
      f.write('\n')
